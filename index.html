<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Pyramid Game - Vote Secret</title>

<style>
body {
  margin: 0;
  font-family: Arial;
  background: #0d0d0d;
  color: white;
  text-align: center;
}

h1 { color: crimson; }

button {
  padding: 10px 20px;
  margin: 10px;
  background: crimson;
  border: none;
  color: white;
  cursor: pointer;
}

input {
  padding: 10px;
  margin: 10px;
}

.page { display: none; padding: 40px; }
.active { display: block; }

.timer {
  font-size: 26px;
  margin: 20px;
  color: gold;
}
</style>
</head>
<body>

<!-- Sons -->
<audio id="tensionSound" loop>
  <source src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3" type="audio/mpeg">
</audio>

<audio id="dramaSound">
  <source src="https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3" type="audio/mpeg">
</audio>

<!-- PAGE 1 -->
<div id="page1" class="page active">
  <h1>Entrer les joueurs</h1>
  <input type="text" id="playerName" placeholder="Nom du joueur">
  <button onclick="addPlayer()">Ajouter</button>
  <button onclick="startVoting()">Commencer</button>
  <div id="playerList"></div>
</div>

<!-- PAGE 2 -->
<div id="page2" class="page">
  <h1 id="voterTitle"></h1>
  <div class="timer" id="timer">03:00</div>
  <div id="voteOptions"></div>
  <button onclick="submitVote()">Valider Vote</button>
</div>

<script>

let players = [];
let currentVoterIndex = 0;
let timeLeft = 180;
let timerInterval;

const tensionSound = document.getElementById("tensionSound");
const dramaSound = document.getElementById("dramaSound");

function showPage(id) {
  document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

function addPlayer() {
  let name = document.getElementById("playerName").value.trim();
  if (!name) return;
  players.push({ name: name, votes: 0 });
  document.getElementById("playerName").value = "";
  updatePlayerList();
}

function updatePlayerList() {
  let list = document.getElementById("playerList");
  list.innerHTML = "<h3>Joueurs :</h3>";
  players.forEach(p => list.innerHTML += p.name + "<br>");
}

function startVoting() {
  if (players.length < 2) {
    alert("Ajoute au moins 2 joueurs !");
    return;
  }

  currentVoterIndex = 0;
  timeLeft = 180;

  showPage("page2");
  tensionSound.play();
  startTimer();
  loadVoter();
}

function loadVoter() {
  if (currentVoterIndex >= players.length) {
    showResults();
    return;
  }

  let voter = players[currentVoterIndex];
  document.getElementById("voterTitle").innerText =
    voter.name + ", vote secr√®tement üëÅ";

  let container = document.getElementById("voteOptions");
  container.innerHTML = "";

  players.forEach((p,i) => {
    if (i !== currentVoterIndex) {
      container.innerHTML += `
        <label>
          <input type="checkbox" value="${i}">
          ${p.name}
        </label><br>
      `;
    }
  });
}

function submitVote() {
  let checkboxes = document.querySelectorAll("#voteOptions input:checked");

  if (checkboxes.length > 5) {
    alert("Maximum 5 votes !");
    return;
  }

  checkboxes.forEach(cb => {
    players[cb.value].votes += 1;
  });

  currentVoterIndex++;
  loadVoter();
}

function startTimer() {
  timerInterval = setInterval(() => {
    timeLeft--;

    let minutes = Math.floor(timeLeft / 60);
    let seconds = timeLeft % 60;

    document.getElementById("timer").innerText =
      (minutes < 10 ? "0" : "") + minutes + ":" +
      (seconds < 10 ? "0" : "") + seconds;

    if (timeLeft <= 0) {
      clearInterval(timerInterval);
      showResults();
    }
  }, 1000);
}

function showResults() {
  clearInterval(timerInterval);
  tensionSound.pause();

  document.body.innerHTML = `
    <div style="
      background:black;
      color:red;
      height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:40px;
      letter-spacing:5px;
      animation: fadeText 2s infinite alternate;
    ">
      LES R√âSULTATS ARRIVENT...
    </div>

    <style>
      @keyframes fadeText {
        from { opacity: 0.3; }
        to { opacity: 1; }
      }
    </style>
  `;

  setTimeout(() => {

    dramaSound.play();

    document.body.innerHTML = `
      <div style="background:#0d0d0d;color:white;text-align:center;font-family:Arial;min-height:100vh;padding:40px;">
        <h1 style="color:crimson;">R√©sultat Final</h1>
        <div id="pyramid"></div>
        <br><br>
        <button onclick="newRound()" 
          style="padding:12px 25px;background:gold;color:black;font-weight:bold;border:none;cursor:pointer;">
          üîÅ Nouvelle Manche
        </button>
      </div>
    `;

    players.sort((a,b) => b.votes - a.votes);
    let pyramid = document.getElementById("pyramid");

    let reversedPlayers = [...players].reverse();
    let index = 0;

    function revealNext() {
      if (index >= reversedPlayers.length) return;

      let player = reversedPlayers[index];
      let realIndex = players.indexOf(player);

      let div = document.createElement("div");
      div.style.margin = "15px auto";
      div.style.padding = "15px";
      div.style.borderRadius = "10px";
      div.style.width = (30 + realIndex * 5) + "%";
      div.style.opacity = "0";
      div.style.transition = "all 0.8s ease";

      if (realIndex === 0) {
        div.style.background = "gold";
        div.style.color = "black";
        div.style.fontSize = "26px";
      } else if (realIndex <= 2) {
        div.style.background = "#ff4d4d";
      } else if (realIndex <= 5) {
        div.style.background = "#4da6ff";
      } else if (realIndex <= 8) {
        div.style.background = "#66ff66";
      } else {
        div.style.background = "#444";
      }

      div.innerHTML = player.name + " - " + player.votes + " votes";
      pyramid.prepend(div);

      setTimeout(() => div.style.opacity = "1", 100);

      index++;
      setTimeout(revealNext, 1500);
    }

    revealNext();

  }, 5000);
}

function newRound() {
  players.forEach(p => p.votes = 0);
  currentVoterIndex = 0;
  timeLeft = 180;
  location.reload();
}

</script>

</body>
</html>
