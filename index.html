<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Jeu Multijoueur</title>
</head>
<body>

<!-- PAGE LOGIN -->
<div id="loginScreen">
  <h2>Entre ton nom</h2>
  <input type="text" id="nameInput" placeholder="Ton nom">
  <button onclick="joinGame()">Entrer</button>
</div>

<!-- PAGE JEU -->
<div id="gameScreen" style="display:none;">
  <h2>Bienvenue dans le jeu ğŸ”¥</h2>
  <button onclick="leaveGame()">Quitter</button>

  <h3>Joueurs connectÃ©s :</h3>
  <ul id="playersList"></ul>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getDatabase, ref, set, onValue, remove, onDisconnect } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCevyMqEcQ1FXLrTG2WUHD6SatVvWzAqF8",
    authDomain: "project-394996803461899153.firebaseapp.com",
    databaseURL: "https://project-394996803461899153-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "project-394996803461899153",
    storageBucket: "project-394996803461899153.firebasestorage.app",
    messagingSenderId: "826202592382",
    appId: "1:826202592382:web:841245858bf2f9229cb42f"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  let playerId = Math.random().toString(36).substr(2, 9);
  let playerRef = null;

  window.joinGame = function() {
    const name = document.getElementById("nameInput").value;

    if (!name) {
      alert("Entre un nom !");
      return;
    }

    playerRef = ref(db, "players/" + playerId);

    set(playerRef, {
      name: name
    }).then(() => {
      document.getElementById("loginScreen").style.display = "none";
      document.getElementById("gameScreen").style.display = "block";
    });

    onDisconnect(playerRef).remove();
  }

  window.leaveGame = function() {
    if (playerRef) {
      remove(playerRef);
    }

    document.getElementById("gameScreen").style.display = "none";
    document.getElementById("loginScreen").style.display = "block";
  }

  const playersRef = ref(db, "players");

  onValue(playersRef, (snapshot) => {
    const data = snapshot.val();
    const list = document.getElementById("playersList");
    list.innerHTML = "";

    if (data) {
      for (let id in data) {
        const li = document.createElement("li");
        li.textContent = data[id].name;
        list.appendChild(li);
      }
    }
  });

</script>

</body>
</html>
