<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Jeu Multijoueur</title>
</head>
<body>

<h2>Entrer ton nom</h2>
<input type="text" id="nameInput" placeholder="Ton nom">
<button onclick="joinGame()">Entrer</button>

<h2>Joueurs connect√©s :</h2>
<ul id="playersList"></ul>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getDatabase, ref, set, onValue, remove, onDisconnect } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCevyMqEcQ1FXLrTG2WUHD6SatVvWzAqF8",
    authDomain: "project-394996803461899153.firebaseapp.com",
    databaseURL: "https://project-394996803461899153-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "project-394996803461899153",
    storageBucket: "project-394996803461899153.firebasestorage.app",
    messagingSenderId: "826202592382",
    appId: "1:826202592382:web:841245858bf2f9229cb42f"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  let playerId = Math.random().toString(36).substr(2, 9);

  window.joinGame = function() {
    const name = document.getElementById("nameInput").value;

    if (!name) {
      alert("Entre un nom !");
      return;
    }

    const playerRef = ref(db, "players/" + playerId);

    set(playerRef, {
      name: name
    });

    onDisconnect(playerRef).remove();
  }

  const playersRef = ref(db, "players");

  onValue(playersRef, (snapshot) => {
    const data = snapshot.val();
    const list = document.getElementById("playersList");
    list.innerHTML = "";

    for (let id in data) {
      const li = document.createElement("li");
      li.textContent = data[id].name;
      list.appendChild(li);
    }
  });

</script>

</body>
</html>
